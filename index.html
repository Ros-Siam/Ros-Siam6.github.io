<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Queue Display</title>
  <style>
    body {
      font-family: sans-serif;
      background-image: url('https://i.imgur.com/ah9IPV9.png'); /* โลโก้ขาหมูรสสยามจางๆ */
      background-repeat: no-repeat;
      background-position: center;
      background-size: 60%;
      background-color: #fff;
      display: flex;
      justify-content: space-around;
      padding: 40px;
    }
    .section {
      width: 40%;
      background: rgba(255, 255, 255, 0.85);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }
    h2 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 20px;
    }
    .order {
      font-size: 36px;
      text-align: center;
      margin: 10px 0;
      background-color: #ffe4b5;
      border-radius: 12px;
      padding: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div class="section" id="preparingSection">
    <h2>กำลังเตรียมอาหาร</h2>
    <div id="preparingOrders"></div>
  </div>

  <div class="section" id="readySection">
    <h2>พร้อมส่ง</h2>
    <div id="readyOrders"></div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      projectId: "ros-siam-queue-management"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // เก็บสถานะปัจจุบันของ order บนหน้าจอ
    let currentPreparing = new Set();
    let currentReady = new Set();

    function updateOrders(snapshot) {
      const newPreparing = new Set();
      const newReady = new Set();

      snapshot.forEach(doc => {
        const data = doc.data();
        const orderNumber = data.orderNumber?.toString();
        const status = data.status;

        if (!orderNumber) return;

        if (status === "preparing") {
          newPreparing.add(orderNumber);
        } else if (status === "ready") {
          newReady.add(orderNumber);
        }
      });

      if (!setsEqual(currentPreparing, newPreparing)) {
        updateSection("preparingOrders", newPreparing);
        currentPreparing = newPreparing;
      }

      if (!setsEqual(currentReady, newReady)) {
        updateSection("readyOrders", newReady);
        currentReady = newReady;
      }
    }

    function updateSection(elementId, ordersSet) {
      const container = document.getElementById(elementId);
      container.innerHTML = ""; // ล้างก่อนแสดงใหม่แบบ smooth
      Array.from(ordersSet).sort().forEach(order => {
        const div = document.createElement("div");
        div.className = "order";
        div.textContent = order;
        container.appendChild(div);
      });
    }

    function setsEqual(a, b) {
      if (a.size !== b.size) return false;
      for (let item of a) if (!b.has(item)) return false;
      return true;
    }

    // เริ่มฟัง Firestore แบบ real-time
    db.collection("orders").onSnapshot(updateOrders);
  </script>

</body>
</html>
